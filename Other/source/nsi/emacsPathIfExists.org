#+TITLE: Add To Path If Exists
#+AUTHOR: Matthew L. Fidler
#+PROPERTY: tangle emacsPathIfExists.nsh
* Intro
Add to path if directory exists macro that tries to overcome the
${NSIS_MAX_STRLEN} when the Path is lonegr than ${NSIS_MAX_STRLEN}...

This is done by calling emacs from autohotkey and setting the
PATH there.
** Path If Exist
#+BEGIN_SRC nsis
Var npath
!macro _PathIfExist ARG1 GOTO
  DetailPrint "Checking ${ARG1}"
  Push $0
  GetFullPathName /SHORT $0 "${ARG1}" 
  IfFileExists "$0" +3
  Pop $0
  Goto +6
  IntOp $npath $npath + 1
  WriteINIStr "$TEMP\ep\ep-env.ini" "path" "$npath" "$0"
  DetailPrint "Add $0 to Path"
  Pop $0
  Goto ${GOTO}

!macroend

!define PathIfExist '!insertmacro "_PathIfExist"'

#+END_SRC
** Info If Exist
Adding info paths
#+BEGIN_SRC nsis
  Var ninfo
  !macro _InfoIfExist ARG1 GOTO
    Push $0
    GetFullPathName /SHORT $0 "${ARG1}" 
    IfFileExists "$0" +3
    Pop $0
    Goto +6
    IntOp $ninfo $ninfo + 1
    WriteINIStr "$TEMP\ep\ep-env.ini" "info" "$ninfo" "$0"
    DetailPrint "Add $0 to to INFOPATH"
    Pop $0
    Goto ${GOTO}
  !macroend
  
  !define InfoIfExist '!insertmacro "_InfoIfExist"'
  
#+END_SRC


** Man If Exist
Adding man paths
#+BEGIN_SRC nsis
  Var nman
  !macro _ManIfExist ARG1 GOTO
    SetOutPath "$TEMP\ep"
    Push $0
    GetFullPathName /SHORT $0 "${ARG1}"     
    IfFileExists "$0" +3
    Pop $0
    Goto +6
    IntOp $nman $nman + 1
    WriteINIStr "$TEMP\ep\ep-env.ini" "man" "$nman" "$0"
    DetailPrint "Add ${ARG1} to to MANPATH"
    Pop $0
    Goto ${GOTO}
  !macroend
  
  !define ManIfExist '!insertmacro "_ManIfExist"'
  
#+END_SRC
